<ion-header [translucent]="true" class="app-header">
  <ion-toolbar>
    <div class="topbar">
      <div class="brand">
        <img src="assets/images/enerbuff-header.png" alt="Enerbuff logo" class="header-logo" />
        <span class="brand-name">Enerbuff</span>
      </div>
      <div class="header-actions">
        <ion-button fill="clear" class="notif-button" aria-label="Notifications" (click)="onNotifications()">
          <ion-icon name="notifications-outline"></ion-icon>
          <ng-container *ngIf="(unreadCount$ | async) as unreadCount">
            <ion-badge *ngIf="unreadCount > 0" class="notif-badge">{{ unreadCount }}</ion-badge>
          </ng-container>
        </ion-button>
        <ion-menu-button class="menu-button"></ion-menu-button>
      </div>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="dashboard">
  <section class="hero">
    <div>
      <h1>Hello Enerbuffer!</h1>
      <p>Here's your energy overview</p>
    </div>
    <div class="hero-pill">Live</div>
  </section>

  <ion-card class="consumption-card">
    <ion-card-content>
      <div class="consumption-top">
        <div>
          <p class="label">Current Consumption</p>
          <p class="value">{{ currentConsumption }} <span>kWh</span></p>
          <p class="updated">Last updated: {{ lastUpdatedLabel }}</p>
        </div>
        <div class="trend">
          <ion-icon name="flash-outline"></ion-icon>
          <span [ngClass]="trendClass">{{ trendValue }} from avg</span>
        </div>
      </div>
      <p class="avg-line">Average (last 5): {{ averageConsumption }} kWh</p>
    </ion-card-content>
  </ion-card>

  <ion-card class="chart-card">
    <ion-card-content>
      <div class="card-header">
        <span>Energy Usage</span>
        <span class="header-sub">Today</span>
      </div>
      <div class="chart-wrap">
        <div class="chart-y">
          <span *ngFor="let label of chartYLabels">{{ label }}</span>
        </div>
        <div class="chart-area">
          <svg viewBox="0 0 320 140" aria-hidden="true">
            <defs>
              <linearGradient id="chartGlow" x1="0" x2="0" y1="0" y2="1">
                <stop offset="0%" stop-color="#2bd96b" stop-opacity="0.4"></stop>
                <stop offset="100%" stop-color="#2bd96b" stop-opacity="0"></stop>
              </linearGradient>
            </defs>
            <path
              [attr.d]="chartPath"
              fill="none"
              stroke="#2bd96b"
              stroke-width="3"
              stroke-linecap="round"
            ></path>
            <path
              [attr.d]="chartAreaPath"
              fill="url(#chartGlow)"
            ></path>
            <circle
              *ngFor="let point of chartData"
              [attr.cx]="point.x"
              [attr.cy]="point.y"
              r="4"
              fill="#2bd96b"
            ></circle>
          </svg>
          <div class="chart-grid"></div>
        </div>
      </div>
      <div class="chart-x">
        <span *ngFor="let label of chartXLabels">{{ label }}</span>
      </div>
      <div class="chart-legend">
        <div *ngFor="let item of chartLegend" class="legend-item">
          <span class="legend-time">{{ item.time }}</span>
          <span class="legend-value">{{ item.value }} kWh</span>
        </div>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- <ion-card class="status-card">
    <ion-card-content>
      <div class="status-row">
        <div>
          <p class="label">Grid Status</p>
          <ion-chip class="status-chip" color="success">High Demand</ion-chip>
          <p class="status-sub">High demand â€” consider reducing usage</p>
        </div>
        <div class="status-icon">
          <ion-icon name="alert-circle-outline"></ion-icon>
        </div>
      </div>
    </ion-card-content>
  </ion-card> -->

  <ion-card class="event-card">
    <ion-card-content>
      <div class="event-row">
        <div>
          <p class="label">Next DR Event</p>
          <h3>Today, 7:00 - 8:30 PM</h3>
          <p class="status-sub">Reward boost: +25% credits</p>
        </div>
        <ion-button class="event-cta" fill="outline" (click)="onJoinEvent()">Join Event</ion-button>
      </div>
    </ion-card-content>
  </ion-card>

  <div class="stats-row">
    <div class="stat-card">
      <div class="stat-icon">
        <ion-icon name="flash-outline"></ion-icon>
      </div>
      <div>
        <p class="stat-value">2,450</p>
        <p class="stat-label">Ener Coins</p>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon blue">
        <ion-icon name="time-outline"></ion-icon>
      </div>
      <div>
        <p class="stat-value">12</p>
        <p class="stat-label">Events Joined</p>
      </div>
    </div>
  </div>

  <ion-card class="activity-card">
    <ion-card-content>
      <div class="card-header">
        <span>Recent Activity</span>
      </div>
      <div class="activity-list">
        <div class="activity-item">
          <span class="activity-dot green"></span>
          <div class="activity-info">
            <h4>DR Event Completed</h4>
            <p>Reduced 2.1 kWh</p>
          </div>
          <span class="activity-chip">+150 coins</span>
        </div>
        <div class="activity-item">
          <span class="activity-dot blue"></span>
          <div class="activity-info">
            <h4>Level Up</h4>
            <p>Reached Silver status</p>
          </div>
          <span class="activity-chip">+200 coins</span>
        </div>
        <div class="activity-item">
          <span class="activity-dot teal"></span>
          <div class="activity-info">
            <h4>Referral Bonus</h4>
            <p>Friend joined Enerbuff</p>
          </div>
          <span class="activity-chip">+300 coins</span>
        </div>
      </div>
    </ion-card-content>
  </ion-card>
</ion-content>


